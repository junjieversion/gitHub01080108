<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>Title</title>
    <link rel="stylesheet" href="css/index.css" type="text/css">
</head>
<body>
<div id="wrap">
    <!--头部-->
    <div id="header">
        <!--上半部-->
        <div id="headerTop">
            <h1 id="logo">
                <a href="###"><img src="img/logo.png" alt=""></a>
            </h1>
            <!--菜单按钮-->
            <a href="###" id="menuBtn" class="menuBtnClos"></a>
            <!--三个按钮-->
            <div id="navs">
                <a href="###" id="searchBtn">搜索</a>
                <a href="###">登陆</a>
                <a href="###">注册</a>
            </div>
        </div>
        <!--
                基线问题
                float: right; 问题
                行内元素转成快：display,浮动
                元素选择器优先级（是否为同一个元素） --- 属性分开写，
                    因为简写属性background，font有默认样式
            -->
        <!--下半部-->
        <form id="search">
            <input type="text" placeholder="请输入搜索内容">
            <input type="submit" value="搜索">
        </form>
        <!--
					怪异盒模型 --- IE ：设置padding向里面挤（content-box）

					<input type="text" placeholder="请输入搜索内容"/>
					placeholder字体样式
						::-webkit-input-placeholder

					清除边框 :  border: none;
					input:行内块元素
				-->
        <!--定位层-->
        <ul id="list">
            <li>
                <a href="javascript:;">首页</a>
            </li>
            <li>
                <a href="javascript:;">MV</a>
            </li>
            <li>
                <a href="javascript:;">悦单</a>
            </li>
            <li>
                <a href="javascript:;">V榜</a>
            </li>
            <li>
                <a href="javascript:;">音悦</a>
            </li>
            <li>
                <a href="javascript:;">商城</a>
            </li>
            <li>
                <a href="javascript:;">节目</a>
            </li>
            <li>
                <a href="javascript:;">饭团</a>
            </li>
            <li>
                <a href="javascript:;">资讯</a>
            </li>
            <li>
                <a href="javascript:;">我的家</a>
            </li>
            <li>
                <a href="javascript:;">APP下载</a>
            </li>
            <li>
                <a href="javascript:;">热门应用</a>
            </li>
        </ul>
    </div>

    <!--内容区-->
    <div id="content">
        <!--导航-->
        <div id="navsWrap">
            <ul id="navsList">
                <li class="active">
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V榜</a>
                </li>
                <li>
                    <a href="javascript:;">音悦</a>
                </li>
                <li>
                    <a href="javascript:;">商城</a>
                </li>
                <li>
                    <a href="javascript:;">节目</a>
                </li>
                <li>
                    <a href="javascript:;">饭团</a>
                </li>
                <li>
                    <a href="javascript:;">资讯</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
            </ul>
        </div>
        <!--无缝滑屏-->
        <div id="ban_wrap">
            <ul id="ban_list">
                <li>
                    <a href="###">
                        <img src="img/1.jpg"/>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="img/2.jpg"/>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="img/3.jpg"/>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="img/4.jpg"/>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="img/5.jpg"/>
                    </a>
                </li>
            </ul>
            <div id="ban_navs">
                <span class="active"></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <!--tab选项卡-->
        <div class="tab">
            <div class="tabHeader">
                <h2>MV首播</h2>
                <a href="###">更多&gt;</a>
            </div>
            <!--导航标签nav 实质是div 被语义化-->
            <nav class="tabNav">
                <a href="###">全部</a>
                <a href="###">内地</a>
                <a href="###">港台</a>
                <a href="###">欧美</a>
                <a href="###">韩国</a>
                <a href="###">日本</a>
                <span></span>
            </nav>
            <div class="tabWrap">
                <ul>
                    <li>
                        <img src="img/a.jpg">
                        <span>君に贈る花がない</span>
                        <div class="ice">
                            <div class="ice_left">
                                <span class="ice_pic"></span>
                                <span>9999</span>
                            </div>
                            <div class="ice_right">
                                <span class="ice_pic"></span>
                                <span>6</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>


</div>
</body>
<script type="text/javascript" src="js/transformCss.js"></script>
<script type="text/javascript">
    document.addEventListener('touchstart', function (event) {
        event.preventDefault();
    });

    //rem适配 自调函数
    (function () {
        var width = document.documentElement.clientWidth;
        var styleN = document.createElement('style');
        styleN.innerHTML = 'html{font-size:' + width / 16 + 'px !important;}';
        document.head.appendChild(styleN);
    })();


    window.onload = function() {

        changeMenu();
        navs();
        changeColor();
        banner();

    };


    //banner区域

    function banner() {

        //获取元素
        var wrap = document.getElementById('ban_wrap');
        var list = document.getElementById('ban_list');
        list.innerHTML += list.innerHTML;
        var liNodes = document.querySelectorAll('#ban_list li');
        var spanNoses = document.querySelectorAll('#ban_navs span');

        //布局
        var styleN = document.createElement('style');
        styleN.innerHTML += '#ban_list {width: ' + liNodes.length + '00%;}';
        styleN.innerHTML += '#ban_list li {width: ' + (100 / liNodes.length) + '%;}';
        styleN.innerHTML += '#ban_wrap {height: ' + liNodes[0].offsetHeight + 'px;}';
        document.head.appendChild(styleN);

        //横向滑屏
        //定义元素和手指初始位置
        var elementX = 0;
        var startX = 0;

        var disX = 0;
        // var translateX = 0;
        var timer = 0;
        var now = 0;

        //防抖动
        var startY = 0;

        //用户手指第一次上来滑动
        var isFirst = true;
        //判断X方向是否执行
        var isX = true;

        wrap.addEventListener('touchstart', function (event) {
            var touch = event.changedTouches[0];

            //清除定时器
            clearInterval(timer);

            //清除过渡
            list.style.transition = 'none';

            //无缝
            var left = transformCss(list, 'translateX');
            var now = Math.round(-left / document.documentElement.clientWidth);


            if (now == 0) {
                now = spanNoses.length;
            } else if (now == liNodes.length - 1) {
                now = spanNoses.length - 1;
            }
            //切换动作
            transformCss(list, 'translateX', -now * document.documentElement.clientWidth);

            //读
            elementX = transformCss(list, 'translateX');
            startX = touch.clientX;

            startY = touch.clientY;

            //重置
            isFirst = true;
            isX = true;

        });

        wrap.addEventListener('touchmove', function (event) {
            var touch = event.changedTouches[0];

            //门
            if (!isX) {
                //禁止X方向逻辑执行
                return;
            }

            //手指结束位置
            var endX = touch.clientX;

            //手指距离差
            disX = endX - startX;

            var endY = touch.clientY;
            var disY = endY - startY;

            //touchmove持续不断触发
            if (isFirst) {

                isFirst = false;

                if (Math.abs(disY) > Math.abs(disX)) {

                    //X上方向逻辑不执行
                    isX = false;
                    disX = 0;
                    // return;失效
                }

            }

            //写
            transformCss(list, 'translateX', disX + elementX);

        });

        wrap.addEventListener('touchend', function () {
            var touch = event.changedTouches[0];

            //读
            var left = transformCss(list, 'translateX');

            now = Math.round(-left / document.documentElement.clientWidth);

            //now范围
            if (now < 0) {
                now = 0;
            } else if (now > liNodes.length - 1) {
                now = liNodes.length - 1;
            }

            //写
            //过渡
            list.style.transition = '2s';
            transformCss(list, 'translateX', -now * document.documentElement.clientWidth);


            //处理小圆点
            for (var i = 0; i < spanNoses.length; i++) {
                spanNoses[i].className = '';
            }
            spanNoses[now % spanNoses.length].className = 'active';

            //开启定时器
            auto();

        });


        //自动轮播
        //模拟now
        auto();
        function auto(){
            //清除定时器
            clearInterval(timer);
            timer = setInterval(function () {

                //无缝
                if (now == liNodes.length-1) {
                    now = spanNoses.length-1;
                };
                //切换动作
                //清除过渡
                list.style.transition = 'none';
                transformCss(list,'translateX', -now*document.documentElement.clientWidth);

                //延时
                setTimeout(function(){
                    now++;
                    list.style.transition = '0.5s';
                    transformCss(list, 'translateX', -now * document.documentElement.clientWidth);

                    //处理小圆点
                    for (var i = 0; i < spanNoses.length; i++) {
                        spanNoses[i].className = '';
                    }
                    spanNoses[now % spanNoses.length].className = 'active';
                },20);

            }, 1000);

        };

    }


    //点击变色

    function changeColor() {

        var liNodes = document.querySelectorAll('#navsList li');

        //给所有li添加touchend
        for (var i = 0; i < liNodes.length; i++) {

            //误触
            liNodes[i].addEventListener('touchmove', function () {
                
                if (!this.isMove) {

                    this.isMove = true;

                };
                
            });

            liNodes[i].addEventListener('touchend', function () {
                
                if (!this.isMove) {

                    //给每一个li添加className
                    for (var j = 0; j < liNodes.length; j++) {

                        liNodes[j].className = '';

                    }

                    this.className = 'active';

                }

                //重置
                this.isMove = false;

            });

        }

    }

    //导航交互

    function navs() {
        var navsWrap = document.getElementById('navsWrap');
        var navsList = document.getElementById('navsList');

        //定义元素初始位置，手指初始位置
        var eleX = 0;
        var startX = 0;

        //加速
        var beginTime = 0;
        var beginValue = 0;
        var endTime = 0;
        var endValue = 0;
        //距离差时间差
        var disTime = 1;
        var disValue = 0;

        navsWrap.addEventListener("touchstart", function (event) {
            var touch = event.changedTouches[0];

            //清除过渡
            navsList.style.transition = 'none';

            eleX = transformCss(navsList, 'translateX');
            startX = touch.clientX;

            beginTime = new Date().getTime();//毫秒
            beginValue = eleX;

            //清除速度
            disValue = 0;

        });

        navsWrap.addEventListener("touchmove", function (event) {
            var touch = event.changedTouches[0];
            //手指结束位置
            var endX = touch.clientX;
            //手指距离差
            var disX = endX - startX;

            //范围限定
            var translateX = disX + eleX;
            var scale = 0;
            var minX = document.documentElement.clientWidth - navsList.offsetWidth;
            if (translateX > 0) {
                // translateX = 0;
                //比例：越来越小
                //    留白/屏幕宽度 （保证不同机型，实现相同效果）
                //留白 逐渐增大 ，scale逐渐减小，   1-留白/屏幕宽度
                scale = 1 - translateX / document.documentElement.clientWidth;

                translateX = translateX * scale;
            } else if (translateX < minX) {
                // translateX = document.documentElement.clientWidth - navsList.offsetWidth;
                var over = minX - translateX;
                scale = 1 - over / document.documentElement.clientWidth;
                translateX = minX - over * scale;
            }

            transformCss(navsList, 'translateX', translateX);

            endTime = new Date().getTime();
            endValue = translateX;
            disValue = endValue - beginValue;
            disTime = endTime - beginTime;

        });

        navsWrap.addEventListener("touchend", function (event) {
            var touch = event.changedTouches[0];

            //速度
            var speed = disValue / disTime;
            console.log(speed);
            //目标位移距离 =  touchmove产生的距离 + 速度计算出的结果
            var target = transformCss(navsList, 'translateX') + speed * 100;

            var minX = document.documentElement.clientWidth - navsList.offsetWidth;
            //橡皮筋回弹效果
            var bezier = '';
            if (target > 0) {
                target = 0;
                bezier = 'cubic-bezier(.09,1.61,.92,1.45)';
            } else if (target < minX) {
                target = minX;
                bezier = 'cubic-bezier(.09,1.61,.92,1.45)';
            }

            navsList.style.transition = '2s ' + bezier;
            transformCss(navsList, 'translateX', target);

        });
    }

    //头部交互

    function changeMenu() {
        var menuBtn = document.getElementById('menuBtn');
        var list = document.getElementById('list');

        menuBtn.addEventListener("touchstart", function (event) {
            if (menuBtn.className == 'menuBtnClos') {
                menuBtn.className = 'menuBtnOpen';
                list.style.display = 'block';
            } else if (menuBtn.className == 'menuBtnOpen') {
                menuBtn.className = 'menuBtnClos';
                list.style.display = 'none';
            }

            //取消冒泡
            event.stopPropagation();
        });

        //点击其他区域，遮罩消失
        document.addEventListener("touchstart", function () {
            if (menuBtn.className == 'menuBtnOpen') {
                menuBtn.className = 'menuBtnClos';
                list.style.display = 'none';
            }
        });

        list.addEventListener("touchstart", function (event) {
            //取消冒泡
            event.stopPropagation();
        })
    }

</script>
</html>